<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Treatment Menu</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;1,400&family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: "Montserrat", sans-serif; margin: 0; padding: 0; line-height: 1.6; color: #333; background-color: #fafafa; }
    h1, h2, h3 { font-family: "Playfair Display", serif; margin: 0; font-weight: 600; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    header { text-align: center; margin-bottom: 20px; }
    header h1 { font-size: 2.2rem; letter-spacing: 2px; text-transform: uppercase; }
    header p { max-width: 700px; margin: 10px auto 0; font-size: 1rem; color: #555; }
    .section-title { font-size: 1.3rem; font-weight: bold; margin: 30px 0 20px; text-transform: uppercase; border-bottom: 2px solid #ddd; padding-bottom: 8px; }
    .menu-item { border-bottom: 1px solid #eee; margin-bottom: 20px; }
    .menu-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 12px 0; }
    .menu-title { display: flex; align-items: center; gap: 10px; }
    .menu-title h3 { font-size: 1.1rem; margin: 0; }
    .menu-meta { text-align: right; font-size: 0.9rem; color: #555; min-width: 150px; }
    .menu-content { display: none; padding: 0 0 15px 0; font-size: 0.95rem; color: #444; }
    .menu-content ul { margin-top: 10px; padding-left: 20px; }
    .menu-item.active .menu-content { display: block; }
    .toggle-icon { font-size: 1.2rem; color: #777; transition: transform 0.3s ease; }
    .menu-item.active .toggle-icon { transform: rotate(45deg); color: #333; }
    .specialties { margin-top: 10px; font-size: 0.9rem; color: #333; }
    .specialties span { background: #f2f2f2; border-radius: 20px; padding: 4px 10px; margin: 3px; display: inline-block; font-size: 0.85rem; }
    .staff-row { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    .staff-avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; cursor: pointer; transition: transform 0.2s, border-color 0.2s; }
    .staff-avatar:hover { transform: scale(1.1); border-color: #c5a46d; }
    footer { margin-top: 50px; font-size: 0.85rem; text-align: center; color: #666; padding-top: 20px; border-top: 1px solid #ddd; }
    .filter-sort { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; }
    .filter-sort select {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
      background-color: rgba(255, 255, 255, 0); /* transparent */
      color: #000; /* force black font */
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D'10'%20height%3D'6'%20viewBox%3D'0%200%2010%206'%20xmlns%3D'http://www.w3.org/2000/svg'%3E%3Cpath%20d%3D'M0%200l5%206%205-6z'%20fill%3D'%23333'%20/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 10px 6px;
      padding-right: 25px;
    }
    @media (max-width: 600px) {
      .menu-header { flex-direction: column; align-items: flex-start; gap: 5px; }
      .menu-meta { text-align: left; }
      .filter-sort { flex-direction: column; }
      .filter-sort select { color: #000; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Treatment Menu</h1>
      <p>Every session blends Traditional Shiatsu, Oil Massage, and Thai Back-to-Back techniques. Personalize your experience with one of our therapists’ unique specialties.</p>
    </header>

    <!-- Filter & Sort UI -->
    <div class="filter-sort">
      <select id="filter-specialty">
        <option value="">All Specialties</option>
        <option value="Shiatsu">Shiatsu</option>
        <option value="Deep Tissue">Deep Tissue</option>
        <option value="Swedish">Swedish</option>
        <option value="Thai">Thai</option>
        <option value="Marma">Marma</option>
        <option value="Lomi Lomi">Lomi Lomi</option>
      </select>
      <select id="filter-duration">
        <option value="">All Durations</option>
        <option value="80">80 Minutes</option>
        <option value="90">90 Minutes</option>
        <option value="100">100 Minutes</option>
        <option value="120">120 Minutes</option>
      </select>
      <select id="sort-criteria">
        <option value="">Sort by</option>
        <option value="popularity">Popularity</option>
        <option value="rating">Rating</option>
        <option value="returning-match">Returning Client Match</option>
      </select>
    </div>

    <!-- Signature Packages -->
    <div class="section-title">Signature Packages</div>

    <!-- Menu Items -->
    <!-- Harmony -->
    <div class="menu-item" data-duration="80" data-specialties="Shiatsu,Swedish,Thai" data-popularity="5" data-rating="4.5">
      <div class="menu-header">
        <div class="menu-title"><span class="toggle-icon">+</span><h3>Harmony Session</h3></div>
        <div class="menu-meta"><p>80 Minutes</p></div>
      </div>
      <div class="menu-content">
        <p>Perfect for a quick but complete reset — balancing energy and releasing daily stress.</p>
        <ul><li>Traditional Shiatsu Massage</li><li>Relaxing Oil Massage</li><li>Thai Back-to-Back Massage</li></ul>
        <div class="specialties"><strong>Available Specialties:</strong><br><span>Shiatsu</span><span>Swedish</span><span>Thai</span></div>
        <div class="staff-row" data-treatment="harmony"></div>
      </div>
    </div>

    <!-- Vitality -->
    <div class="menu-item" data-duration="90" data-specialties="Shiatsu,Deep Tissue,Swedish" data-popularity="8" data-rating="4.7">
      <div class="menu-header">
        <div class="menu-title"><span class="toggle-icon">+</span><h3>Vitality Session</h3></div>
        <div class="menu-meta"><p>90 Minutes</p></div>
      </div>
      <div class="menu-content">
        <p>Extended session time for deeper relief, improved circulation, and enhanced relaxation.</p>
        <ul><li>Traditional Shiatsu Massage</li><li>Relaxing Oil Massage</li><li>Thai Back-to-Back Massage</li></ul>
        <div class="specialties"><strong>Available Specialties:</strong><br><span>Shiatsu</span><span>Deep Tissue</span><span>Swedish</span></div>
        <div class="staff-row" data-treatment="vitality"></div>
      </div>
    </div>

    <!-- Zen -->
    <div class="menu-item" data-duration="100" data-specialties="Marma,Lomi Lomi,Deep Tissue" data-popularity="3" data-rating="4.2">
      <div class="menu-header">
        <div class="menu-title"><span class="toggle-icon">+</span><h3>Zen Balance Session</h3></div>
        <div class="menu-meta"><p>100 Minutes</p></div>
      </div>
      <div class="menu-content">
        <p>A deeper journey for body and mind, allowing slow, intentional techniques for lasting calm.</p>
        <ul><li>Traditional Shiatsu Massage</li><li>Relaxing Oil Massage</li><li>Thai Back-to-Back Massage</li></ul>
        <div class="specialties"><strong>Available Specialties:</strong><br><span>Marma</span><span>Lomi Lomi</span><span>Deep Tissue</span></div>
        <div class="staff-row" data-treatment="zen"></div>
      </div>
    </div>

    <!-- Renewal -->
    <div class="menu-item" data-duration="120" data-specialties="Shiatsu,Lomi Lomi,Marma,Deep Tissue" data-popularity="6" data-rating="4.8">
      <div class="menu-header">
        <div class="menu-title"><span class="toggle-icon">+</span><h3>Complete Renewal</h3></div>
        <div class="menu-meta"><p>120 Minutes</p></div>
      </div>
      <div class="menu-content">
        <p>The ultimate session — unhurried, immersive, and restorative for full-body renewal.</p>
        <ul><li>Traditional Shiatsu Massage</li><li>Relaxing Oil Massage</li><li>Thai Back-to-Back Massage</li></ul>
        <div class="specialties"><strong>Available Specialties:</strong><br><span>Shiatsu</span><span>Lomi Lomi</span><span>Marma</span><span>Deep Tissue</span></div>
        <div class="staff-row" data-treatment="renewal"></div>
      </div>
    </div>

    <footer><p>Enhance your journey by selecting a therapist whose specialty aligns with your needs.</p></footer>
  </div>

  <script>
    // Accordion toggle
    document.querySelectorAll(".menu-header").forEach(header => {
      header.addEventListener("click", () => {
        const item = header.parentElement;
        item.classList.toggle("active");
        header.querySelector(".toggle-icon").textContent = item.classList.contains("active") ? "−" : "+";
      });
    });

    // Render staff avatars
    function renderStaff(staffRecommendations) {
      document.querySelectorAll(".staff-row").forEach(row => {
        const treatmentKey = row.dataset.treatment;
        const staff = staffRecommendations[treatmentKey] || [];
        row.innerHTML = "";
        staff.forEach(person => {
          const img = document.createElement("img");
          img.src = person.img;
          img.alt = person.name;
          img.title = person.name;
          img.className = "staff-avatar";
          row.appendChild(img);
        });
      });
    }

    function transformCMSData(cmsData) {
      const transformed = { harmony: [], vitality: [], zen: [], renewal: [] };
      cmsData.forEach(item => {
        let key = item.title_fld.toLowerCase().split(' ')[0];
        transformed[key] = transformed[key] || [];
        transformed[key].push({
          name: `${item.description_fld} — ${item.imagealttext_fld}`,
          img: item.imageAvatar
        });
      });
      return transformed;
    }

    window.addEventListener("message", (event) => {
      if (event.data && Array.isArray(event.data)) {
        const staffRecommendations = transformCMSData(event.data);
        renderStaff(staffRecommendations);
      }
    }, false);

    // FILTER & SORT LOGIC
    function filterAndSortMenu() {
      const specialtyFilter = document.getElementById('filter-specialty').value.toLowerCase();
      const durationFilter = document.getElementById('filter-duration').value;
      const sortCriteria = document.getElementById('sort-criteria').value;

      const items = Array.from(document.querySelectorAll('.menu-item'));

      // Filter
      items.forEach(item => {
        const itemSpecialties = item.dataset.specialties.toLowerCase();
        const itemDuration = item.dataset.duration;
        const show = 
          (!specialtyFilter || itemSpecialties.includes(specialtyFilter)) &&
          (!durationFilter || itemDuration === durationFilter);
        item.style.display = show ? '' : 'none';
      });

      // Sort
      if (sortCriteria) {
        const container = document.querySelector('.container');
        items.sort((a, b) => {
          if (sortCriteria === 'popularity') {
            return b.dataset.popularity - a.dataset.popularity;
          } else if (sortCriteria === 'rating') {
            return b.dataset.rating - a.dataset.rating;
          } else if (sortCriteria === 'returning-match') {
            // Placeholder for returning client match
            return b.dataset.popularity - a.dataset.popularity;
          }
          return 0;
        });
        items.forEach(item => container.appendChild(item));
      }
    }

    document.getElementById('filter-specialty').addEventListener('change', filterAndSortMenu);
    document.getElementById('filter-duration').addEventListener('change', filterAndSortMenu);
    document.getElementById('sort-criteria').addEventListener('change', filterAndSortMenu);
  </script>
</body>
</html>
